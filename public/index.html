<!DOCTYPE html>
<html lang="en">
<head>
    <title>Island Madness</title>
    <link rel="preload" as="font" href="assets/font/SinglyLinkedRegular-vmoRL.otf" />
    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
</head>
    <style>
        @font-face {
            font-family: 'CustomFont';
            src: url('./assets/font/SinglyLinkedRegular-vmoRL.otf');
            font-size: larger;
        }
        body{
            display: grid;
            justify-items: center;
            align-items: center  ;
            margin: 0;
            background-color: rgb(115, 147, 179);
        }
        .fontload{
            visibility:hidden;
            position: absolute;
            left: -9999px;
        }
    </style>

    <body class="game">
        <div class="fontload" style="font-family: 'CustomFont';">.</div>
        <script type="text/javascript">

            var config = {
                type: Phaser.AUTO,
                backgroundColor: '#7393B3',
                pixelArt: false,
                mipmapFilter: 'LINEAR_MIPMAP_LINEAR',
                physics: {
                    default: "arcade",
                    arcade: {
                        // gravity: { y: 300 },
                        debug: false
                    }
                },
                scene: {
                    preload: preload,
                    create: create,
                    update: update
                },
                scale: {
                    mode: Phaser.Scale.ENVELOP,
                    autoCenter: Phaser.Scale.CENTER_BOTH,
                    width: 1920,
                    height: 990,
                },
                render: {
                    antialias: true,
                },
                roundPixels: true
            }

            var background;
            var helicopter;
            var boat;
            var shark;
            var heart;
            var cursorKeys;
            var man;
            var score = 0;
            var timer;
            var scoreText;
            var scoreLabel;
            var fail = 0;
            var life = fail;
            var shark1;
            var shark2;
            var velocity = 40;
            var helVelocity = -160
            var  menu;
            var startGame = false;
            var playButton;
            var enterKey;
            var gameName;
            var startGameText;
            var gameOver;
            var helicopterSound;
            var successSound;
            var failureSound;
            var platformLeft;
            var platformRight;
            var finalScore;
            var mute;
            var unmute;
            var gameOverText;
            var move = 0;
            var treeGroup;
            var tree1,tree2,tree3;
            var lol =0;
            var ray;
            var backgroundMusic;
            var restart = false;
            var restartButton;
            var failAnimation = true;
            var deens;

            var game = new Phaser.Game(config);

            function preload(){
                this.load.image("frame", "assets/frame_new.png");
                this.load.image("background", "assets/Background/Background.png");
                this.load.spritesheet("helicopter", "assets/Background/spritesheet.png",{
                    frameWidth: 399,
                    frameHeight: 150
                });
                this.load.image("tree1", "assets/Background/tree1.png")
                this.load.image("tree2", "assets/Background/tree2.png")
                this.load.image("tree3", "assets/Background/tree3.png")

                this.load.image("mountains", "assets/Background/Mountains.png")
                
                this.load.image("star", "assets/star.png");
                this.load.image("boat", "assets/Background/Boat.png");
                this.load.image("shark2", "assets/Background/Boat.png");
                this.load.image('platform', 'assets/platform.png');
                this.load.image('platformLeft', 'assets/platform.png');
                this.load.image('platformRight', 'assets/platform.png');
                this.load.image("man", "assets/man.png");
                this.load.image("heart", "assets/Background/heart.png");
                this.load.image("shark1", "assets/Background/Fish.png");
                this.load.image("button", "assets/uipack_fixed/PNG/green_button00.png")
                this.load.image("menu", "assets/menu.png");
                this.load.image("mute", "assets/mute.png");
                this.load.image("unmute", "assets/unmute.png");
                this.load.audio("heli", "assets/helicopter.mp3");
                this.load.audio("success", "assets/success.mp3");
                this.load.audio("fail", "assets/fail.wav");
                this.load.audio("gameOver", "assets/gameOver.mp3");
                this.load.audio("music", "assets/Background/beachMusic.mp3");
                this.load.image("name", "assets/Background/Title.png")
                this.load.image("gameOverImage", "assets/Background/gameOver.png")
                this.load.image("startButton", "assets/Background/Button.png")
                this.load.image("ray", "assets/Background/rays.png")
                this.load.image("restart", "assets/Background/restart.png")
                // this.load.spritesheet('helicopter', as)

                this.load.bitmapFont("pixelFont", "assets/font/font.png", "assets/font/font.xml");
            }

            function create(){
                this.physics.world.setBounds(420, 1594, 1050, 1980, true, true, false)
                
                helicopterSound = this.sound.add("heli");
                helicopterSound.play({ volume: 0.4, loop: true });
                
                successSound = this.sound.add("success");
                failureSound = this.sound.add("fail")
                gameOverSound = this.sound.add("gameOver");

                backgroundMusic = this.sound.add("music");
                backgroundMusic.play({ volume: 0.8, loop: true });

                if (!this.sound.locked)
                {
                    // already unlocked so play
                    helicopterSound.play()
                    backgroundMusic.play()
                }
                else
                {
                    // wait for 'unlocked' to fire and then play
                    this.sound.once(Phaser.Sound.Events.UNLOCKED, () => {
                            helicopterSound.play()
                        backgroundMusic.play()
                    })
                }
                
                background = this.add.image(950, 515, "background");
                background.setScale(0.65)
                // background.setOrigin(0, 0);
                
                // frame.setOrigin(0, 0);
                tree2 = this.add.image(1430, 600, "tree2");
                tree2.setOrigin(1,1);
                tree2.scale = .4

                tree3 = this.add.image(860, 590, "tree3");
                tree3.setOrigin(1,1);
                tree3.setScale(0.4)

                tree1 = this.add.image(1170, 600, "tree1");
                tree1.setOrigin(1,1);
                // tree1.setAnchor(10.0, 0.5);
                console.log(tree1);
                tree1.scale = 0.5

                mountains = this.add.image(940, 505, "mountains");
                mountains.setScale(0.7)
                



                
                this.anims.create({
                    key: "helicopter_anims",
                    frames: this.anims.generateFrameNumbers("helicopter", {
                        start: 0,
                        end: 3
                    }),
                    frameRate: 30,
                    repeat: -1
                });

                platform = this.physics.add.image(950, 890, 'platform')
                platform.visible = false;
                platform.scaleX = 2.5

                platformLeft = this.physics.add.staticImage(240, 340, 'platform')
                platformLeft.visible = false
                platformLeft.scaleX = 0
                platformLeft.scaleY = 10
                
                
                platformRight = this.physics.add.staticImage(1655, 340, 'platform')
                platformRight.visible = false
                platformRight.scaleX = 0
                platformRight.scaleY = 10
                
                // this.helicopter = this.add.image(130,100, 'helicopter').setScale(0.5);
                helicopter = this.physics.add.sprite(1350,290, 'helicopter').setScale(0.5).refreshBody().setInteractive();
                console.log(helicopter);
                helicopter.play("helicopter_anims");
                helicopter.setVelocityX(helVelocity);
                helicopter.setCollideWorldBounds(true);
                helicopter.setBounce(1);
                this.physics.add.collider(helicopter, platformLeft, flipChopper, null, this)
                this.physics.add.collider(helicopter, platformRight, flipChopper, null, this)
                
                unmute = this.add.image(1440, 230, 'mute').setScale(0.35)
                unmute.inputEnabled = true;
                unmute.setInteractive();
                unmute.on('pointerdown', muteSound);
                unmute.visible = false;

                mute = this.add.image(1440, 230, 'unmute').setScale(0.35)
                mute.inputEnabled = true;
                mute.setInteractive();
                mute.on('pointerdown', muteSound);

                // unmute = this.add.image(1310, 310, 'unmute').setScale(0.09)

                shark2 = this.physics.add.image(770, 715, 'shark1').setScale(0.7).refreshBody();
                shark2.setVelocityX(velocity);

                boat = this.physics.add.image(950, 745, 'boat')
                boat.setScale(0.25)
                boat.setSize(400,40)
                boat.setCollideWorldBounds(true);
                
                shark1 = this.physics.add.image(1100, 700, 'shark1').setScale(0.7).refreshBody();
                shark1.setVelocityX(velocity);
                
                
                heart = this.add.group({
                    key: 'heart',
                    repeat: 2,
                    setXY: { x: 440, y: 240, stepX: 30 },
                    setScale: { x: 0.08, y: 0.08 }
                })
                
                frame = this.add.image(955, 490, "frame");
                frame.setScale(1.68).setDepth(1)

                timer = this.time.addEvent({ delay: Math.round(Math.random() * (3500 - 1000) + 1000), callback: createStar, callbackScope: this, loop: true });
                
                
                cursorKeys = this.input.keyboard.createCursorKeys();
                
                this.score = 0;
                var scoreFormated = zeroPad(this.score, 6);
                scoreLabel = this.add.text(427, 200, "SCORE : 000000" , { fontFamily: 'CustomFont', fontSize: 20, fill: '#eef0f3',stroke: '#000000', strokeThickness: 3 });
                ray = this.add.image(970, 500, "ray").setScale(0.7).setAlpha(0.15)
                // gameName = this.add.bitmapText(730, 300, "pixelFont", "Island-Madness", 90)
                // gameName = this.add.text(690, 500, "Island-Madness", { fontFamily: 'CustomFont', fontSize: 65 })
                // gameName.setStroke('black', 5)
                gameName = this.add.image(970, 520, "name").setScale(0.3)
                // startGameText = this.add.bitmapText(780, 580, "pixelFont", "Press any key to start", 50)
                // gameOver = this.add.bitmapText(820, 540, "pixelFont", "GAME OVER!" , 85).setDepth(1);
                startGameText = this.add.image(970, 640, "startButton").setScale(0.2).setDepth(1).setAlpha(0).setInteractive();
                startGameText.on('pointerdown', function(){ startGame = true });

                startGameText.on('pointerover', function(pointer){ startGameText.setScale(0.6) })
                startGameText.on('pointerout', function(pointer){ startGameText.setScale(0.5) })

                restartButton = this.add.image(970, 650, "restart").setScale(0.08).setDepth(1).setAlpha(0).setInteractive();
                restartButton.on('pointerdown', function() {
                    console.log(fail)
                    startGame = false
                    restart = true
                });

                restartButton.on('pointerover', function(pointer){ restartButton.setScale(0.09) })
                restartButton.on('pointerout', function(pointer){ restartButton.setScale(0.08) })
                
                gameOverText = this.add.image(970, 490, "gameOverImage").setScale(0.25).setDepth(1).setAlpha(0);
                // finalScore = this.add.bitmapText(770, 570, "pixelFont", "Final Score : 000000", 60).setDepth(1);
                finalScore = this.add.text(970, 570, "Final Score : 000000", { fontFamily: 'CustomFont', fontSize: 45, fill: '#eef0f3',stroke: '#000000', strokeThickness: 3 }).setDepth(1).setAlpha(0).setInteractive();
                finalScore.setOrigin(0.5, 0.5);


                var gameNameTeen = this.tweens.add({
                    targets: [gameName],
                    alpha: { from: 0, to: 1 },
                    scale: { from: 0, to: 0.3 },
                    duration: 2000,
                    ease: 'Back.easeInOut',
                    repeat: 0,
                    onComplete: function(){
                        
                        this.tweens.add({
                            targets: [startGameText],
                            alpha: { from: 0, to: 1 },
                            scale: { from: 0, to: 0.5 },
                            duration: 1500,
                            ease: 'Back.easeInOut',
                            repeat: 0,
                            // onComplete: function(){
                            //     gameName.alpha = 0.5;
                            // },
                            callbackScope: this
                        })
                    },
                    callbackScope: this
                })

                console.log(this);

                // enterKey = this.input.keyboard.on('keydown', function(){ startGame = true });
                // enterKey = this.input.on('pointerdown', function(){ startGame = true });
                // menu = this.add.image(950, 550, 'menu').setScale(1.3).setDepth(1)

                // playButton = this.add.image(950, 600, 'button').setInteractive().on(Phaser.Input.Events.GAMEOBJECT_POINTER_DOWN, () => {
                //     startGame = true;
                // }).setDepth(1)

                // this.add.filter(100);

                var tween = this.tweens.addCounter({
                    from: 3,
                    to: 1,
                    duration: 4000,
                    repeat: -1,
                    onUpdate: function (tween)
                    {
                        //  tween.getValue = range between 0 and 360

                        tree1.setAngle(tween.getValue());
                    },
                    yoyo: true
                });

                var tween = this.tweens.addCounter({
                    from: 0.2,
                    to: 2,
                    duration: 4000,
                    repeat: -1,
                    onUpdate: function (tween)
                    {
                        //  tween.getValue = range between 0 and 360

                        tree2.setAngle(tween.getValue());
                    },
                    yoyo: true
                });

                var tween = this.tweens.addCounter({
                    from: 5,
                    to: 1,
                    duration: 4000,
                    repeat: -1,
                    onUpdate: function (tween)
                    {
                        //  tween.getValue = range between 0 and 360

                        tree3.setAngle(tween.getValue());
                    },
                    yoyo: true
                });

                var rayOpacity = this.tweens.add({
                    targets: ray,
                    alpha: 0.5,
                    duration: 1000,
                    ease: 'Linear',
                    repeat: -1,
                    // onComplete: function(){
                    //     gameName.alpha = 0.5;
                    // },
                    yoyo: true,
                    callbackScope: this
                });
                deens = this.tweens

                this.tweens.add({
                    targets: shark1,
                    x: 1230,
                    ease: 'Linear',
                    duration: 3000,
                    flipX: true,
                    yoyo: true,
                    repeat: -1
                });

                this.tweens.add({
                    targets: shark2,
                    x: 830,
                    ease: 'Linear',
                    duration: 5000,
                    flipX: true,
                    yoyo: true,
                    repeat: -1
                });

                this.tweens.add({
                    targets: boat,
                    y: 740,
                    ease: 'Quad.easeInOut',
                    duration: 2000,
                    yoyo: true,
                    repeat: -1
                });
            }

            // function restart(){
            //     console.log("lol")
            //     this.scene.restart();
            // }
            
            function update() {

                if(restart === true){
                    backgroundMusic.pause();
                    restart = false;
                    fail = 0;
                    failAnimation = true;
                    this.scene.restart();
                }

                if(!startGame){
                    // game.loop.sleep();
                    // this.physics.pause();
                    // this.anims.pauseAll();
                    scoreLabel.visible = false;
                    heart.setVisible(false);

                    // gameOverText.visible = false;
                    gameName.visible = true;
                    startGameText.visible = true
                    // finalScore.visible = false
                    // gameName.setTint(0xffffff, 0x000000, 0x000000, 0xffffff);
                    
                    gameName.y = 520 + Math.sin(-move)*2;
                    gameName.x = 980 + Math.cos((10*0.3) + move)*2;

                    // tree1.x = 980 + Math.cos((3*0.8) + move)*0.9;
                    move += 0.07;

                    // if(Phaser.Input.Keyboard.JustDown(enterKey)){
                    //     startGame = true;
                    // }
                }
                else if(startGame){

                    backgroundMusic.setVolume(0.3);
                    game.loop.resume();
                    this.physics.resume();

                    // gameName.visible = false;
                    startGameText.visible = false;
                    scoreLabel.visible = true;
                    heart.setVisible(true);
                    

                    var nameTeen = this.tweens.add({
                        targets: gameName,
                        scale: 0,
                        alpha: 0,
                        duration: 1000,
                        ease: 'Linear',
                        repeat: 0,
                        // onComplete: function(){
                        //     gameName.alpha = 0.5;
                        // },
                        callbackScope: this
                    })

                    var rayTeen = this.tweens.add({
                        targets: ray,
                        alpha: 0,
                        duration: 1000,
                        ease: 'Linear',
                        repeat: 0,
                        // onComplete: function(){
                        //     gameName.alpha = 0.5;
                        // },
                        callbackScope: this
                    })
                    
                    if(fail == 3){
                        game.loop.sleep();
                        this.physics.pause();
                        this.anims.pauseAll();
                        helicopterSound.pause();
                        // finalScore.visible = true;
                        scoreLabel.visible = false;
                        // restartButton.visible = true;
                        // failAnimation = true;
                        startAnimation();
                        // this.tweens.add({
                        // targets: [gameOverText, finalScore, restartButton],
                        // alpha: 1,
                        // ease: 'Linear',
                        // duration: 1000,
                        // callbackScope: this
                        // });
                        return;
                    }

                    
                    moveBoatManager();
                    
                    // if(man){
                    //     // if(star.body.checkWorldBounds()){
                    //     //     console.log("lol")
                    //     // }
                    //     // if(!Phaser.Geom.Intersects.RectangleToRectangle(man.body, this.physics.world.bounds)){
                    //     //     console.log("ureka")
                    //     // }
                        
                    //     if(man.y > 900){
                    //         // console.log(this.star.y)
                    //         fail += 1;
                    //         man.destroy();
                    //         // console.log(fail)
                    //     }
                    // }
    
                    
    
                    // if(helicopter.body.x < 551){
                    //     helicopter.toggleFlipX();
                    // }
                    // else if(helicopter.body.x > 1175){
                    //     helicopter.toggleFlipX();
                    // }
                    // console.log(helicopter.body.x)
                    
                    // if(helicopter.body.checkWorldBounds())
                    // {   console.log("")
                    //     helicopter.toggleFlipX();
                    // }
                }

                    // if(shark1.body.x > 1190){
                    //     shark1.toggleFlipX();
                    //     shark1.setVelocityX(-velocity);
                    // }if(shark1.body.x <1000){
                    //     shark1.toggleFlipX();
                    //     shark1.setVelocityX(velocity);
                    // }
    
                    // if(shark2.body.x > 850){
                    //     shark2.flipX = true;
                    //     shark2.setVelocityX(-velocity);
                    // }else if(shark2.body.x < 700){
                    //     shark2.toggleFlipX();
                    //     shark2.setVelocityX(velocity);
                    // }

            }

            function startAnimation(){
                if(failAnimation === true){
                    failAnimation = false;
                    var iol = deens.add({
                        targets: [gameOverText],
                        alpha: 1,
                        scale: { from: 0, to: 0.2 },
                        ease: 'Back.easeInOut',
                        duration: 1000,
                        callbackScope: this,
                        onComplete: function(){
                            // gameOverText.y = 490 + Math.sin(move)*2;
                            // gameOverText.x = 970 + Math.cos((10*0.3) + move)*2;
        
                            // move += 0.07;
                            
                            deens.add({
                            targets: [finalScore],
                            alpha: { from: 0, to: 1 },
                            scale: { from: 0, to: 1 },
                            ease: 'Back.easeInOut',
                            duration: 1000,
                            callbackScope: this,
                            onComplete: function(){
                                deens.add({
                                targets: [restartButton],
                                scale: { from: 0, to: 0.08 },
                                alpha: { from: 0, to: 1 },
                                ease: 'Back.easeInOut',
                                duration: 1000,
                                callbackScope: this,
                                })
                            }
                            })
                    
                        }

                        
                    });

                }
            }

            function moveBoatManager(){

                boat.setVelocity(0);

                if(this.cursorKeys.left.isDown){
                    boat.setVelocityX(-470);
                }
                else if(this.cursorKeys.right.isDown){
                    boat.setVelocityX(470)
                }
            }

            function flipChopper(helicopter){
                console.log("lol")
                helicopter.toggleFlipX();
            }

            function createStar(){
                if(startGame){
                    man = this.physics.add.image(helicopter.x,helicopter.y, 'man').setSize(180,300).setScale(0.17);
                    man.setGravityY(Math.round(Math.random() * (300 - 10) + 10));
                    this.physics.add.overlap(man, boat, catchStar, null, this);
                    this.physics.add.overlap(man, platform, removeLife, null, this);

                }
            }

            function removeLife(man){
                fail += 1
                life = fail
                // console.log(heart)
                heart.remove(heart.getLast(true), true);
                failureSound.play({ volume: 0.7});
                man.destroy();
            }

            function catchStar(man){
                score += 10;
                var scoreFormated = zeroPad(score, 6);
                scoreLabel.text = "SCORE : " + scoreFormated;
                finalScore.text = "Final Score : " + scoreFormated;
                successSound.play({ volume: 0.4});
                man.destroy();
            }

            function zeroPad(number, size){
                var stringNumber = String(number);
                while(stringNumber.length < (size || 2)){
                    stringNumber = "0" + stringNumber;
                }
                return stringNumber;
            }

            function createButton(game, string, x ,y, w, h, callback){
                console.log(this)
                var button = this.add.button(x, y, 'button', callback, this, 2, 1, 0);
                button.anchor.setTo(0.5, 0.5);
                button.width = 560;
                button.height = 285;

                var txt = game.add.text(button.x, button.y, 'Hello', {
                    font: "14px Arial",
                    fill: "#fff",
                    align: "center"
                })
                txt.anchor.setTo(0.5, 0.5)
            }

            function muteSound() {
                if (!game.sound.mute) {
                    game.sound.mute = true;
                    unmute.visible = true;
                    unmute.setDepth(1)
                } else {
                    game.sound.mute = false;
                    unmute.visible = false;
                    mute.setDepth(1)
                }
            }

            function unmuteSound() {
                mute.visible = true;
                unmute.visible = false;
                game.sound.mute = false;
            }
        </script>
    </body>
</html>